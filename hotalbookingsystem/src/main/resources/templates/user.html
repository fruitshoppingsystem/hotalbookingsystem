<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
    	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    	<!-- Mobile Web-app fullscreen -->
    	<meta name="apple-mobile-web-app-capable" content="yes">
    	<meta name="mobile-web-app-capable" content="yes">

    	<!-- Meta tags -->
    	<meta name="description" content="">
    	<meta name="author" content="">
    	<link rel="icon" href="favicon.ico">

    	<!--Title-->
		<title>用户个人界面</title>
		<!--CSS styles-->
    	<link rel="stylesheet" media="all" href="css/bootstrap.css" />
    	<link rel="stylesheet" media="all" href="css/animate.css" />
    	<link rel="stylesheet" media="all" href="css/font-awesome.css" />
    	<link rel="stylesheet" media="all" href="css/linear-icons.css" />
    	<link rel="stylesheet" media="all" href="css/hotel-icons.css" />
    	<link rel="stylesheet" media="all" href="css/magnific-popup.css" />
    	<link rel="stylesheet" media="all" href="css/owl.carousel.css" />
    	<link rel="stylesheet" media="all" href="css/datepicker.css" />
    	<link rel="stylesheet" media="all" href="css/theme.css" />

    	<!--Google fonts-->
    	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,500&amp;subset=latin-ext" rel="stylesheet">
    	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext" rel="stylesheet">


    	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    	<!--[if lt IE 9]>
    	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    	<![endif]-->
    	<script type="text/javascript">
			window.onload = function(){
				document.getElementById("showbox1").onclick = function(){
					document.getElementById("box2").style.display = "none";
					document.getElementById("box3").style.display = "none";
					document.getElementById("box1").style.display = "block";
				}
				document.getElementById("showbox2").onclick = function(){
					document.getElementById("box1").style.display = "none";
					document.getElementById("box3").style.display = "none";
					document.getElementById("box2").style.display = "block";
				}
				document.getElementById("showbox3").onclick = function(){
					document.getElementById("box1").style.display = "none";
					document.getElementById("box2").style.display = "none";
					document.getElementById("box3").style.display = "block";
				}
			}
		</script>
	</head>
	<body>
		
		<div class="page-loader"></div>
		
		<div class="wrapper">

        <header>

            <!-- ======================== Navigation ======================== -->

            <div class="container">

                <!-- === navigation-top === -->

                <nav class="navigation-top clearfix">
					<!-- navigation-top-left -->

                    <div class="navigation-top-left">
                        
                    </div>

                    <!-- navigation-top-right -->

                    <div class="navigation-top-right">
                        <a class="box" href="index.html">
                            <i class="glyphicon glyphicon-log-out"></i> 
                            	退出登录
                        </a>
                        <a class="box" onclick="deleteUser()">
                            <i class="glyphicon glyphicon-trash"></i> 
                            	注销账号
                        </a>
                    </div>
                </nav>

                <!-- === navigation-main === -->

                <nav class="navigation-main clearfix">

                    <!-- logo -->

                    <div class="logo animated fadeIn">
                        <a href="index.html">
                            <img class="logo-desktop" src="images/logo.png" alt="Alternate Text" />
                            <img class="logo-mobile" src="images/logo-mobile.png" alt="Alternate Text" />
                        </a>
                    </div>

                    <!-- toggle-menu -->

                    <div class="toggle-menu"><i class="icon icon-menu"></i></div>

                    <!-- navigation-block -->

                    <div class="navigation-block clearfix">

                        <!-- navigation-left -->

                        <ul class="navigation-left" role="tablist">
                            <li role="presentation" class="active">
                                <a id="showbox1">个人信息 </a>
                            </li>
                            <li role="presentation">
                                <a id="showbox3">我的订单 </a>
                            </li>
                        </ul>

                        <!-- navigation-right -->

                        <ul class="navigation-right">
                            
                        </ul>

                    </div> <!--/navigation-block-->

                </nav>
            </div> <!--/container-->

        </header>
        
        <!-- ========================  Facility ======================== -->

        <section class="page">

            <!-- ===  Page header === -->

            <div class="page-header" style="background-image:url(images/header-1.jpg)">
                <div class="container text-center">
                    <h2 class="title" th:text="${user.UName}">用户名</h2>
                    <p>欢迎登录</p>
                </div>
            </div>

			<div class="checkout">
                <div class="container">
                	<div class="clearfix">
                		<div class="content" id="box1" align="center" style="display: block;">
                    		<label>用户名：</label><p th:text="${user.UName}"></p><br />
							<label>性别：</label><p th:text="${uSex}"></p><br />
							<label>年龄：</label><p th:text="${uAge}"></p><br />
							<label>电话：</label><p th:text="${user.UPhone}"></p><br />
							<label>身份证号：</label><p th:text="${user.UIDCard}"></p><br />
							<button type="button" class="btn btn-clean-dark" id="showbox2">修改信息</button>
                		</div>
                		<div class="content" id="box2" align="center" style="display: none;">
                    		<label>用户名：<input id="name" type="text" th:value="${user.UName}"></label><br />
							<label>性别：<input id="sex" type="text" th:value="${uSex}"></label><br />
							<label>年龄：<input id="age" type="text" th:value="${uAge}"></label><br />
							<label>电话：<input id="phone" type="text" th:value="${user.UPhone}"></label><br />
							<label>身份证号：<input id="idCard" type="text" th:value="${user.UIDCard}"></label><br />
							<a class="btn btn-clean-dark" onclick="updateUser()">确定修改</a>
                		</div>
                		<div class="content" id="box3" align="center" style="display: none;">
							<table class="table table-hover table-striped table-bordered table-condensed">
                                <thead>
								<tr>
									<td>订单号</td>
									<td>房间类型</td>
									<td>到达日期</td>
									<td>离开日期</td>
									<td>预订天数</td>
									<td>客人数量</td>
									<td>总金额</td>
                                    <td>房间号</td>
                                    <td>房间楼层</td>
									<td>订单状态</td>
									<td>操作</td>
								</tr>
                                </thead>
                                <tbody>
                                <tr th:each="order:${orders}">
                                    <td th:text="${order.OId}"></td>
                                    <td th:text="${order.roomType}"></td>
                                    <td th:text="${order.ATime}"></td>
                                    <td th:text="${order.LTime}"></td>
                                    <td th:text="${order.dayNum}"></td>
                                    <td th:text="${order.UNum}"></td>
                                    <td th:text="${order.totalPrise}"></td>
                                    <td th:text="${order.roomId}"></td>
                                    <td th:text="${order.roomFloor}"></td>
                                    <td th:text="${order.OState}"></td>
                                    <td>
                                        <button class="btn btn-clean-dark" th:onclick="comment([[${order.roomId}]], [[${order.roomType}]], [[${order.OState}]]);">评论</button>
                                        <button class="btn btn-clean-dark" th:onclick="unsubscribe([[${order.OId}]], [[${order.OState}]]);">申请退订</button>
                                    </td>
                                </tr>
                                </tbody>
							</table>
                       	</div> <!--/content-->
    				</div>
    			</div>
    		</div>
        </section>

		<br />
        <!-- ========================  Subscribe ======================== -->

        <section class="subscribe">
            <div class="container">
                <div class="box">
                    <h2 class="title">感谢</h2>
                    <div class="text">
                        <p>非常感谢各位客户的支持</p>
                    </div>
                    <a href="contact.html"><button class="btn btn-clean">联系我们</button></a>
                </div>
            </div>
        </section> 

        <!-- ================== Footer  ================== -->

        <footer>
            <div class="container">

                <!--footer social-->

                <div class="footer-social">
                    <div class="row">
                        <div class="col-sm-12 text-center hidden">
                            <a href="" class="footer-logo"><img src="images/logo.png" alt="Alternate Text" /></a>
                        </div>
                        <div class="col-sm-12 icons">
                            
                        </div>
                        <div class="col-sm-12 copyright">
                            
                        </div>
                        <div class="col-sm-12 text-center">
                            <img src="images/logo-footer.png" alt="" />
                        </div>
                    </div>
                </div>
            </div>
        </footer>

    </div> <!--/wrapper-->
        <form id="form">
        </form>
    <!--JS files-->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/jquery.bootstrap.js"></script>
    <script src="js/jquery.magnific-popup.js"></script>
    <script src="js/jquery.owl.carousel.js"></script>
    <script src="js/main.js"></script>
        <script th:inline="javascript">
            function updateUser() {
                var uEmail = [[${uEmail}]];
                var uName = $("#name").val();
                var uSex = $("#sex").val();
                var uAge = $("#age").val();
                var uPhone = $("#phone").val();
                var uIDCard = $("#idCard").val();
                $.ajax({
                    async:false,
                    url : "/user/updateUser",
                    datatype : "String",
                    type : "post",
                    data:{
                        uEmail:uEmail,uName:uName, uSex:uSex, uAge:uAge, uPhone:uPhone, uIDCard:uIDCard
                    },success:function (res) {
                        if (res === true){
                            alert("修改成功");
                            document.getElementById("form").action="/userPage?uEmail="+uEmail;
                            document.getElementById("form").method="post";
                            document.getElementById("form").submit();
                        }else{
                            alert("修改失败");
                        }
                    },error:function () {
                        alert("失败");
                    }
                });
            }
            function deleteUser() {
                var uEmail = [[${uEmail}]];
                $.ajax({
                    async:false,
                    url : "/user/deleteUser",
                    datatype : "String",
                    type : "post",
                    data:{
                        uEmail:uEmail
                    },success:function (res) {
                        if (res === true){
                            alert("注销成功");
                            document.getElementById("form").action="/indexPage";
                            document.getElementById("form").method="post";
                            document.getElementById("form").submit();
                        }else{
                            alert("注销失败");
                        }
                    },error:function () {
                        alert("失败");
                    }
                });
            }
            function comment(roomId, roomType, oState) {
                var uEmail = [[${uEmail}]];
                var uName = [[${user.UName}]];
                if (oState !== "已退房"){
                    alert("请退房后评论");
                }else {
                    document.getElementById("form").action="/commentPage?uEmail="+uEmail+"&uName="+uName+"&roomId="+roomId+"&roomType="+roomType;
                    document.getElementById("form").method="post";
                    document.getElementById("form").submit();
                }
            }
            function unsubscribe(oId, oState) {
                var uEmail = [[${uEmail}]];
                if (oState !== "已支付"){
                    alert("此订单不能申请退订");
                }else {
                    $.ajax({
                        async:false,
                        url : "/order/unsubscribe",
                        datatype : "String",
                        type : "post",
                        data:{
                            oId:oId
                        },success:function (res) {
                            if (res === true){
                                alert("申请成功");
                                document.getElementById("form").action="/userPage?uEmail="+uEmail;
                                document.getElementById("form").method="post";
                                document.getElementById("form").submit();
                            }else{
                                alert("申请失败");
                            }
                        },error:function () {
                            alert("失败");
                        }
                    });
                }
            }
        </script>
	</body>
</html>
