<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- Mobile Web-app fullscreen -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Meta tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <!--Title-->
    <title>预订房间-步骤2</title>

    <!--CSS styles-->
    <link rel="stylesheet" media="all" href="css/bootstrap.css" />
    <link rel="stylesheet" media="all" href="css/animate.css" />
    <link rel="stylesheet" media="all" href="css/font-awesome.css" />
    <link rel="stylesheet" media="all" href="css/linear-icons.css" />
    <link rel="stylesheet" media="all" href="css/hotel-icons.css" />
    <link rel="stylesheet" media="all" href="css/magnific-popup.css" />
    <link rel="stylesheet" media="all" href="css/owl.carousel.css" />
    <link rel="stylesheet" media="all" href="css/datepicker.css" />
    <link rel="stylesheet" media="all" href="css/theme.css" />

    <!--Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,500&amp;subset=latin-ext" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700&amp;subset=latin-ext" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <div class="page-loader"></div>

    <div class="wrapper">

        <header>

            <!-- ======================== Navigation ======================== -->

            <div class="container">

                <!-- === navigation-top === -->

                <nav class="navigation-top clearfix">

                    <!-- navigation-top-left -->

                    <div class="navigation-top-left">
                        
                    </div>

                    <!-- navigation-top-right -->

                    <div class="navigation-top-right">
                        <a class="box" href="register.html">
                            <i class="glyphicon glyphicon-list"></i> 
                            	注册
                        </a>
                        <a class="box" href="login.html">
                            <i class="glyphicon glyphicon-log-in"></i> 
                            	登录
                        </a>
                    </div>
                </nav>

                <!-- === navigation-main === -->

                <nav class="navigation-main clearfix">

                    <!-- logo -->

                    <div class="logo animated fadeIn">
                        <a href="index.html">
                            <img class="logo-desktop" src="images/logo.png" alt="Alternate Text" />
                            <img class="logo-mobile" src="images/logo-mobile.png" alt="Alternate Text" />
                        </a>
                    </div>

                    <!-- toggle-menu -->

                    <div class="toggle-menu"><i class="icon icon-menu"></i></div>

                    <!-- navigation-block -->

                    <div class="navigation-block clearfix">

                        <!-- navigation-left -->

                        <ul class="navigation-left">
                            <li>
                                <a href="index.html">首页 </a>
                            </li>
                            <li>
                                <a href="about.html">酒店介绍 </a>
                            </li>
                            <li>
                                <a href="facility.html">酒店设施 </a>
                            </li>
                        </ul>

                        <!-- navigation-right -->

                        <ul class="navigation-right">
                            <li>
                                <a href="/userCommentPage">用户评论 </a>
                            </li>
                            <li>
                                <a href="rooms-category.html">房间分类 <span class="open-dropdown"><i class="fa fa-angle-down"></i></span></a>
                                <ul>
                                    <li><a href="singleRoom.html">单人房</a></li>
                                    <li><a href="doubleRoom.html">双人房</a></li>
                                    <li><a href="queenSizeBed.html">大床房</a></li>
                                    <li><a href="familySuite.html">家庭套房</a></li>
                                    <li><a href="presidentialSuite.html">总统套房</a></li>
                                    <li><a href="luxuryApartment.html">豪华公寓</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="contact.html">联系我们 </a>
                            </li>
                        </ul>

                    </div> <!--/navigation-block-->

                </nav>
            </div> <!--/container-->

        </header>

        <!-- ========================  Checkout ======================== -->

        <section class="page">

            <!-- ===  Page header === -->

            <div class="page-header" style="background-image:url(images/header-1.jpg)">
                <div class="container">
                    <h2 class="title">确认您的预订</h2>
                    <p>客人信息</p>
                </div>
            </div>

            <!-- ===  Step wrapper === -->

            <div class="step-wrapper">
                <div class="container">
                    <div class="stepper">
                        <ul class="row">
                            <li class="col-md-4 active">
                                <a href=""><span data-text="房间信息"></span></a>
                            </li>
                            <li class="col-md-4 active">
                                <a href=""><span data-text="客人信息"></span></a>
                            </li>
                            <li class="col-md-4">
                                <a href=""><span data-text="支付"></span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ===  Checkout === -->

            <div class="checkout">

                <div class="container">

                    <div class="clearfix">

                        <!-- ========================  Note block ======================== -->

                        <div class="cart-wrapper">

                            <div class="note-block">

                                <div class="row">
                                	<!-- === login-wrapper === -->

                                    <div class="login-wrapper">

                                        <div class="white-block">

                                            <!--signin-->

                                            <div class="login-block login-block-signup">
                                                <div class="h4">登录 </div>
                                                <hr />
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <input id="email" type="email" value="" class="form-control" placeholder="邮箱">
                                                            <label id="email_trip"></label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <input id="password" type="password" value="" class="form-control" placeholder="密码">
                                                            <label id="password_trip"></label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <div class="form-group">
                                                            <img id="codeImg" src="/code/getCode" alt="更换验证码" onclick="getCode()">
                                                        </div>
                                                    </div>

                                                    <div class="col-md-10">
                                                        <div class="form-group">
                                                            <input id="code" type="text" value="" class="form-control" placeholder="验证码" onblur="checkCode()">
                                                            <label id="code_trip"></label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div> <!--/signup-->
                                        </div>
                                    </div> <!--/login-wrapper-->
                                </div>
                            </div>
                        </div>

                        <!-- ========================  Cart wrapper ======================== -->

                        <div class="cart-wrapper">

                            <!--cart header -->

                            <div class="cart-block cart-block-header clearfix">
                                <div>
                                    <span>房间类型</span>
                                </div>
                                <div class="text-right">
                                    <span>价格</span>
                                </div>
                            </div>

                            <!--cart items-->

                            <div class="clearfix">

                                <div class="cart-block cart-block-item clearfix">
                                    <div class="image">
                                        <a><img th:src="${image}" alt="" /></a>
                                    </div>
                                    <div class="title">
                                        <div class="h2"><a th:href="${href}" th:text="${roomType}"></a></div>
                                        <p>
                                            <strong>到达时间</strong> <br /> <a th:text="${aTime}"></a>
                                        </p>
                                        <p>
                                            <strong>客人数量</strong> <br />  <a th:text="${uNum}"></a>
                                        </p>
                                        <p>
                                            <strong>预订天数</strong> <br /> <a th:text="${dayNum}"></a>
                                        </p>
                                    </div>
                                    <div class="price">
                                        <span class="final h3" th:text="${price}"></span>
                                    </div>
                                </div>

                            </div>

                            <!-- ========================  Cart navigation ======================== -->

                            <div class="clearfix">
                                <div class="cart-block cart-block-footer cart-block-footer-price clearfix">
                                    <div>
                                        <a onclick="back()" class="btn btn-clean-dark">返回</a>
                                    </div>
                                    <div>
                                        <a onclick="submit()" class="btn btn-main">支付 <span class="icon icon-chevron-right"></span></a>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>

                </div> <!--/container-->
            </div> <!--/checkout-->

        </section>



        <!-- ========================  Subscribe ======================== -->

        <section class="subscribe">
            <div class="container">
                <div class="box">
                    <h2 class="title">感谢</h2>
                    <div class="text">
                        <p>非常感谢各位客户的支持</p>
                    </div>
                    <a href="contact.html"><button class="btn btn-clean">联系我们</button></a>
                </div>
            </div>
        </section> 

        <!-- ================== Footer  ================== -->

        <footer>
            <div class="container">

                <!--footer social-->

                <div class="footer-social">
                    <div class="row">
                        <div class="col-sm-12 text-center hidden">
                            <a href="" class="footer-logo"><img src="images/logo.png" alt="Alternate Text" /></a>
                        </div>
                        <div class="col-sm-12 icons">
                            
                        </div>
                        <div class="col-sm-12 copyright">
                            
                        </div>
                        <div class="col-sm-12 text-center">
                            <img src="images/logo-footer.png" alt="" />
                        </div>
                    </div>
                </div>
            </div>
        </footer>

    </div> <!--/wrapper-->
    <form id="form">

    </form>
    <!--JS files-->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/jquery.bootstrap.js"></script>
    <script src="js/jquery.magnific-popup.js"></script>
    <script src="js/jquery.owl.carousel.js"></script>
    <script src="js/main.js"></script>
    <script th:inline="javascript">
        function back() {
            var roomType = [[${roomType}]];
            var aTime = [[${aTime}]];
            var lTime = [[${lTime}]];
            var uNum = [[${uNum}]];
            var dayNum = [[${dayNum}]];
            var price = [[${price}]];
            var image = [[${image}]];
            var href = [[${href}]];
            document.getElementById("form").action="/reservation1Page?roomType="+roomType+"&aTime="+aTime+"&lTime="+lTime+"&uNum="+uNum+"&dayNum="+dayNum+"&price="+price+"&image="+image+"&href="+href;
            document.getElementById("form").method="post";
            document.getElementById("form").submit();
        }
        function getCode() {
            $("#code").val("");
            $("#codeImg").attr("src", 'code/getCode?' + Math.random());
        }

        function trip(obj, trip) {
            document.getElementById(obj).innerHTML = "<b>" + trip + "</b>";
        }

        function checkInput() {
            //校验邮箱:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/
            var inputEmail = document.getElementById("email");
            var uEmail = inputEmail.value;
            if (!/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/.test(uEmail)) {
                trip("email_trip", "邮箱不合法!!");
                return false;
            } else {
                trip("email_trip", "");
                return true;
            }
        }

        function checkPassword() {
            //密码长度6~18
            var password = document.getElementById("password");
            var pass = password.value;
            if (pass.length < 6|| pass.length > 18) {
                trip("password_trip", "密码为6~18位!!");
                return false;
            } else {
                trip("password_trip", "");
                return true;
            }
        }

        function checkCode() {
            var value = document.getElementById("code");
            var code = value.value;
            if (code.length !== 4) {
                trip("code_trip", "验证码为4位!!");
                return false;
            } else {
                trip("code_trip", "");
                return true;
            }
        }

        function checkForm() {
            if (checkInput() && checkPassword() && checkCode()){
                return true;
            }else {
                alert("格式错误");
                return false;
            }
        }

        function submit() {
            var code=$("#code").val();
            var radio = $("input[name='type']:checked").val();
            $.ajax({
                async: true,
                type: 'post',
                url: '/code/checkCode',
                dataType:'json',
                data: {
                    code: code
                },
                success: function (res) {
                    if (res === true){
                        userLogin();
                    }else {
                        alert("验证码错误");
                        getCode();
                    }
                },
                error: function (){
                    alert("失败");
                }
            });
        }
        function userLogin() {
            if (checkForm()){
                var uEmail=$("#email").val();
                var uPassword=$("#password").val();
                $.ajax({
                    async:false,
                    url : "/user/userLogin",
                    datatype : "String",
                    type : "post",
                    data:{
                        uEmail:uEmail, uPassword:uPassword
                    },success:function (res) {
                        if (res === true){
                            var roomType = [[${roomType}]];
                            var aTime = [[${aTime}]];
                            var lTime = [[${lTime}]];
                            var uNum = [[${uNum}]];
                            var dayNum = [[${dayNum}]];
                            var price = [[${price}]];
                            $.ajax({
                                async:false,
                                url : "/order/addOrder",
                                datatype : "String",
                                type : "post",
                                data:{
                                    uEmail:uEmail, aTime:aTime, lTime:lTime, uNum:uNum, dayNum:dayNum, totalPrise:price, roomType:roomType
                                },success:function (oId) {
                                    document.getElementById("form").action="/pay?oId="+oId;
                                    document.getElementById("form").method="post";
                                    document.getElementById("form").submit();
                                },error:function () {
                                    alert("失败");
                                }
                            });
                        }else{
                            alert("邮箱或密码错误");
                        }
                    },error:function () {
                        alert("失败");
                    }
                });
            }
        }
    </script>
</body>

</html>